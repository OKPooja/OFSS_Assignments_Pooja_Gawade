
CREATE TABLE MEMBER (
    member_Id Number(5) PRIMARY KEY,
    member_name Varchar2(30) NOT NULL,
    member_address Varchar2(50) NOT NULL,
    acc_open_date date,
    membership_type varchar2(20) NOT NULL,
    fees_paid number(10) NOT NULL,
    max_books_allowed number(2),
    penalty_amount number(7,2)
);

CREATE TABLE BOOKS (
    book_no number(6)PRIMARY KEY,
    book_name varchar2(30) NOT NULL,
    author_name varchar2(30) NOT NULL,
    cost number(7,2) NOT NULL,
    category char(10) NOT NULL
);

CREATE TABLE Issue(
    lib_issue_id number(10),
    book_no number(6),
    member_Id number(5),
    issue_date date,
    return_date date,
    FOREIGN KEY (member_Id) REFERENCES MEMBER(member_Id),
    FOREIGN KEY (book_no) REFERENCES BOOKS(book_no)
);

ALTER TABLE ISSUE ADD REFERENCE CHAR(30);
ALTER TABLE ISSUE DROP COLUMN REFERENCE;
ALTER TABLE MEMBER MODIFY fees_paid number(10);
DESC ISSUE;

INSERT INTO MEMBER VALUES('1', 'Richa Sharma', 'Pune', '10-Dec-2005', 'Lifetime', 25000, 5, 50);
INSERT INTO MEMBER VALUES('2', 'Garima Sen', 'Pune', SYSDATETIMEOFFSET, 'Annual', 1000, 3, null);
INSERT INTO MEMBER VALUES('3', 'Jagjeet Singh Sappalllllll', 'Pune', '10-Dec-2005', 'Lifetime', 25000, 5, 50);
INSERT INTO MEMBER VALUES('4', 'Jagjeet Singh Sappalllllll', 'Pune', '10-Dec-2007', 'Quarterly', 25000, 2, 10);
ALTER TABLE MEMBER MODIFY member_name varchar2(20);
INSERT INTO MEMBER VALUES('5', 'Ram Sharma', 'Mumbai', '20-Jan-2002', 'Quarterly', 30000, 110, 10);
-- SQL> INSERT INTO MEMBER VALUES('5', 'Ram Sharma', 'Mumbai', '20-Jan-2002', 'Quarterly', 30000, 110, 10)
-- ORA-01438: value 110 greater than specified precision (2, 0) for column 
-- https://docs.oracle.com/error-help/db/ora-01438/
-- Error at Line: 4 Column: 0
CREATE TABLE MEMBER101 AS SELECT * FROM MEMBER;
SELECT * FROM MEMBER101;
ALTER TABLE MEMBER ADD CONSTRAINT check_books_allowed CHECK(max_books_allowed < 100);
ALTER TABLE MEMBER ADD CONSTRAINT penalty_amt CHECK(penalty_amount  <= 1000);

DROP TABLE BOOKS;
ALTER TABLE BOOKS ADD CONSTRAINT check_category CHECK(category IN('Science', 'Fiction', 'Database', 'RDBMS', 'Others'));
INSERT INTO BOOKS VALUES(101,'Let Us C', 'Denis Ritchie', 450, 'System');
-- ORA-02290: check constraint (SQL_USKL9Q1LDWVFXRU9BUPIT7U67W.CHECK_CATEGORY) violated
-- https://docs.oracle.com/error-help/db/ora-02290/
-- Error at Line: 4 Column: 0
INSERT INTO BOOKS VALUES(102,'Oracle â€“ Complete Ref', 'Loni', 550, 'Database');
INSERT INTO BOOKS VALUES(103,'Mastering SQL', 'Loni', 250, 'Database');
INSERT INTO BOOKS VALUES(104,'PL SQL-Ref', 'Scott Urman', 750, 'Database');
INSERT INTO BOOKS VALUES(101,'Let Us C', 'Denis Ritchie', 450, 'Others');
INSERT INTO BOOKS (book_no, book_name, author_name, cost, category)
VALUES (&book_no, &book_name, &author_name, &cost, &category);

CREATE TABLE Book101 AS
SELECT * FROM Books WHERE 1=0;
DESC BOOK101;
INSERT INTO BOOK101 SELECT * FROM BOOKS;
SELECT * FROM BOOK101;
COMMIT;
SELECT * FROM BOOKS;
INSERT INTO BOOKS values(105, 'National Geographic', 'Adis Scott', 1000, 'Science')
ROLLBACK;
DROP TABLE Issue;

CREATE TABLE Issue (
    Lib_Issue_Id NUMBER PRIMARY KEY,
    Book_No NUMBER,
    Member_ID NUMBER,
    Issue_Date DATE,
    Return_Date DATE,
    CONSTRAINT fk_book FOREIGN KEY (Book_No) REFERENCES Books(Book_No),
    CONSTRAINT fk_member FOREIGN KEY (Member_ID) REFERENCES Member(Member_ID),
    CONSTRAINT chk_dates CHECK (Issue_Date < Return_Date)
);
INSERT INTO Issue VALUES (7001, 101, 1, TO_DATE('10-Dec-2006', 'DD-Mon-YYYY'), NULL);
INSERT INTO Issue VALUES (7002, 102, 2, TO_DATE('25-Dec-2006', 'DD-Mon-YYYY'), NULL);
INSERT INTO Issue VALUES (7003, 104, 1, TO_DATE('15-Jan-2006', 'DD-Mon-YYYY'), NULL);
INSERT INTO Issue VALUES (7004, 101, 1, TO_DATE('04-Jul-2006', 'DD-Mon-YYYY'), NULL);
INSERT INTO Issue VALUES (7005, 104, 2, TO_DATE('15-Nov-2006', 'DD-Mon-YYYY'), NULL);
INSERT INTO Issue VALUES (7006, 101, 3, TO_DATE('18-Feb-2006', 'DD-Mon-YYYY'), NULL);
COMMIT;
ALTER TABLE Issue DISABLE CONSTRAINT fk_book;
ALTER TABLE Issue DISABLE CONSTRAINT fk_member;
ALTER TABLE Issue DISABLE CONSTRAINT chk_dates;
INSERT INTO Issue VALUES (7007, 101, 999, TO_DATE('01-Aug-2006', 'DD-Mon-YYYY'), NULL);
ALTER TABLE Issue ENABLE CONSTRAINT fk_member;

DELETE FROM Issue WHERE Lib_Issue_Id = 7007;
COMMIT;
ALTER TABLE Issue ENABLE CONSTRAINT fk_member;
DELETE FROM Member WHERE Member_ID = 1;
UPDATE Issue SET Return_Date = Issue_Date + 15 WHERE Lib_Issue_Id IN (7004, 7005);
UPDATE Member SET Penalty_Amount = 100 WHERE Member_Name = 'Garima Sen';
SAVEPOINT X;
DELETE FROM Issue WHERE Member_ID = 1 AND Issue_Date < TO_DATE('10-Dec-2006', 'DD-Mon-YYYY');

DELETE FROM Books WHERE Category NOT IN ('RDBMS', 'Database');
ROLLBACK TO SAVEPOINT X;
COMMIT;
DROP TABLE Member101;
DROP TABLE Book101;

-- data
SELECT * FROM Member;
SELECT * FROM Issue;
SELECT * FROM Book;

-- desc
DESC Member;
DESC Issue;
DESC Book;
CREATE SEQUENCE no_seq START WITH 100 INCREMENT BY 2 MAXVALUE 200 NOCYCLE;
DROP SEQUENCE no_seq;

CREATE SEQUENCE book_seq START WITH 101 INCREMENT BY 1 MAXVALUE 1000 NOCYCLE;
CREATE SEQUENCE member_seq START WITH 1 INCREMENT BY 1 MAXVALUE 100 NOCYCLE;

DROP SEQUENCE book_seq;
DROP SEQUENCE member_seq;
